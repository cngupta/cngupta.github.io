

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>  Chirag Gupta</title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="Chirag Gupta">
<meta property="og:title" content="Chirag Gupta">


  <link rel="canonical" href="https://cngupta.github.io/pubs/">
  <meta property="og:url" content="https://cngupta.github.io/pubs/">





  <meta name="twitter:site" content="@chiraggupta_In">
  <meta name="twitter:title" content="Chirag Gupta">
  <meta name="twitter:description" content="computational biologist">
  <meta name="twitter:url" content="https://cngupta.github.io/pubs/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  












  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Chirag Gupta",
      "url" : "https://cngupta.github.io",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="https://cngupta.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Chirag Gupta Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://cngupta.github.io/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    

<!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="https://cngupta.github.io/images/apple-touch-icon-57x57.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="60x60" href="https://cngupta.github.io/images/apple-touch-icon-60x60.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="72x72" href="https://cngupta.github.io/images/apple-touch-icon-72x72.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="76x76" href="https://cngupta.github.io/images/apple-touch-icon-76x76.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="114x114" href="https://cngupta.github.io/images/apple-touch-icon-114x114.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="120x120" href="https://cngupta.github.io/images/apple-touch-icon-120x120.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="144x144" href="https://cngupta.github.io/images/apple-touch-icon-144x144.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="152x152" href="https://cngupta.github.io/images/apple-touch-icon-152x152.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="180x180" href="https://cngupta.github.io/images/apple-touch-icon-180x180.png?v=M44lzPylqQ">
<link rel="icon" type="image/png" href="https://cngupta.github.io/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32">
<link rel="icon" type="image/png" href="https://cngupta.github.io/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192">
<link rel="icon" type="image/png" href="https://cngupta.github.io/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96">
<link rel="icon" type="image/png" href="https://cngupta.github.io/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16">
<link rel="manifest" href="https://cngupta.github.io/images/manifest.json?v=M44lzPylqQ">
<link rel="mask-icon" href="https://cngupta.github.io/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000">
<link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ">
<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="https://cngupta.github.io/images/mstile-144x144.png?v=M44lzPylqQ">
<meta name="msapplication-config" content="https://cngupta.github.io/images/browserconfig.xml?v=M44lzPylqQ">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="https://cngupta.github.io/assets/css/academicons.css"/>

<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>

<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://cngupta.github.io/">Chirag Gupta</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://cngupta.github.io/portfolio/">Research</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://cngupta.github.io/publications/">Publications</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://cngupta.github.io/talks/">Talks</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://cngupta.github.io/cv/">CV</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://cngupta.github.io/tutorials/">Tutorials</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://cngupta.github.io/media/">Media</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://cngupta.github.io/contact/">Contact</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    



<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="https://cngupta.github.io/images/profile.jpg" class="author__avatar" alt="Chirag Gupta">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Chirag Gupta</h3>
    <p class="author__bio">Computational Biologist</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Arkansas, USA</li>
      
      
      
      
        <li><a href="mailto:cxg040@uark.edu"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i> Email</a></li>
      
      
       
        <li><a href="https://www.researchgate.net/profile/Chirag_Gupta3"><i class="fab fa-fw fa-researchgate" aria-hidden="true"></i> ResearchGate</a></li>
      
      
        <li><a href="https://twitter.com/chiraggupta_In"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
        <li><a href="https://www.linkedin.com/in/cngupta"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
      
      
      
      
      
      
        <li><a href="https://github.com/cngupta"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        <li><a href="https://scholar.google.com/citations?hl=en&user=DatsM4kAAAAJ"><i class="fas fa-fw fa-graduation-cap"></i> Google Scholar</a></li>
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <div class="archive">
    
      <h1 class="page__title"></h1>
    
    <p>This tutorial will help wet-lab biologists get started with analysis of their first RNA-seq dataset. 
You can essentially perform all these steps on platforms with user-friendly interface, 
such as the Galaxy server. But doing it on the terminal is a lot more fun, and of course saves a lot of time. 
Also, this workflow deals with analyzing RNA-seq data when a reference genome is available. 
In case if you have no reference genome available, you might want to take a shot at de novo assembly of transcriptomes, 
which is a different ballgame and hence different combination of software at play. 
I will write a separate tutorial on that sometime later.</p>

<p>I am assuming that you already have access to all software listed below. 
If not, install them first using instructions given on their individual pages.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>We will need the following software for the workflow</p>
<ol>
  <li><a href="https://www.bioinformatics.babraham.ac.uk/projects/download.html">Fastqc</a></li>
  <li><a href="https://github.com/alexdobin/STAR">STAR</a></li>
  <li><a href="http://www.htslib.org/download/">Samtools</a></li>
  <li><a href="https://htseq.readthedocs.io/en/release_0.8.0/install.html">Htseq</a></li>
  <li><a href="https://github.com/ewels/MultiQC">Multiqc</a></li>
  <li>R packages limma and edgeR</li>
</ol>

<h2 id="setting-up-project-directory">Setting up project directory</h2>

<p>Open the terminal and type</p>
<pre>
mkdir rnaproj
cd rnaproj
mkdir raw outputs genome 
mkdir genome/star_index
mkdir outputs/bams outputs/counts
mkdir outputs/bams/tmp
</pre>

<p>This will create a directory structure we will use throughout this tutorial.</p>

<h2 id="obtaining-tutorial-data">Obtaining tutorial data</h2>
<p>Skip this section if you already have data to work with.
We will develop our workflow with this Arabidopsis dataset from GEO. It has two conditions
(control and drought treatment) with two replicates each. A total of four samples.</p>

<p>Download this data from SRA in the raw directory</p>
<pre>
cd raw
fastq-dump 
</pre>

<h2 id="quality-check">Quality check</h2>
<pre>
fastqc *.fastq.gz
multiqc .
</pre>

<p>Click on the *.html file. How is the data per sample? quality overall? Are the ends good? needs trimming?</p>

<h2 id="alignment">Alignment</h2>

<p>We will use the STAR aligner to map our reads to the reference genome.
But first, we will need to create an index for the reference genome.</p>

<pre>
cd ../
star index 
</pre>

<p>This will create index files in the star_index directory. Next, we will start aligning the reads in our fastq files of our first sample to the reference genome.</p>

<p>Run STAR</p>
<pre> 
star --genomeDir genome/star_index  --runThreadN 32 --readFilesIn raw/pe1 raw/pe2 --outFileNamePrefix outputs/bams/s1.bam --outSAMtype BAM Unsorted
star --genomeDir genome/star_index  --runThreadN 32 --readFilesIn raw/pe1 raw/pe2 --outFileNamePrefix outputs/bams/s1.bam --outSAMtype BAM Unsorted
star --genomeDir genome/star_index  --runThreadN 32 --readFilesIn raw/pe1 raw/pe2 --outFileNamePrefix outputs/bams/s1.bam --outSAMtype BAM Unsorted
star --genomeDir genome/star_index  --runThreadN 32 --readFilesIn raw/pe1 raw/pe2 --outFileNamePrefix outputs/bams/s1.bam --outSAMtype BAM Unsorted
</pre>

<p>Sort with samtools</p>
<pre>
samtools sort -@ 32 -T outputs/bams/tmp -O BAM -o outputs/bams/sorted.bam outputs/bams/s1.bam 
samtools sort -@ 32 -T outputs/bams/tmp -O BAM -o outputs/bams/sorted.bam outputs/bams/s1.bam 
samtools sort -@ 32 -T outputs/bams/tmp -O BAM -o outputs/bams/sorted.bam outputs/bams/s1.bam 
samtools sort -@ 32 -T outputs/bams/tmp -O BAM -o outputs/bams/sorted.bam outputs/bams/s1.bam 
</pre>

<p>These four bam file contains information about where each sequenced read aligned in the reference genome. 
The bam files also contain other information such as the read quality and alignment rate. 
We can actually check what percentage of reads in each of our fastq files aligned correctly.</p>

<pre>
cd outputs/bams/
multiqc *.bams
</pre>

<p>This will produce an html file looking something like this. What percentage of reads aligned in each sample?</p>

<h2 id="counting-reads">Counting reads</h2>
<p>Our intention is to estimate expression levels of known gene models, therefore 
we will use the GTF file of Arabidopsis to count reads per gene.</p>
<pre>
htseq-count -r pos -f bam sorted.bam genome/gtf &gt; outputs/counts/s1.counts
htseq-count -r pos -f bam sorted.bam genome/gtf &gt; outputs/counts/s1.counts
htseq-count -r pos -f bam sorted.bam genome/gtf &gt; outputs/counts/s1.counts
htseq-count -r pos -f bam sorted.bam genome/gtf &gt; outputs/counts/s1.counts
</pre>

<p>You should have a total of 4 counts files for the four samples. Let’s check that</p>

<pre>
ls outputs/counts/*.counts | wc -l
</pre>

<p>Merge the four count files using this R script.</p>

<h2 id="expression">Expression</h2>
<p>Now that we have our count files for the four samples, we will need to first normalize 
these counts before we go about estimating expression levels. 
<a href="https://hbctraining.github.io/DGE_workshop/lessons/02_DGE_count_normalization.html" target="_blank">Why is normalization necessary?</a></p>

<p>I have written an R script to normalize gene count data using 
<a href="https://genomebiology.biomedcentral.com/articles/10.1186/gb-2014-15-2-r29">voom</a> 
and DE analysis using <a href="https://academic.oup.com/nar/article/43/7/e47/2414268">limma</a>. 
This script will also output Transcript Per Million (TPM) units as a measure of gene expression
in case if you want to compare genes within the same sample.</p>

<pre>
mkdir codes
wget Rscript
mv rscript codes
Rscript codes/rscript counts/countmatrix.txt genome/GTF  
</pre>


  </div>
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<a href="/sitemap/">Sitemap</a>
<!-- end custom footer snippets -->

        	

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/chiraggupta_In"><i class="fab fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/cngupta"><i class="fab fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://cngupta.github.io/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Chirag Gupta. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <script src="https://cngupta.github.io/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');
</script>






  </body>
</html>

